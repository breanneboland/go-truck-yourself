{% extends 'base.html' %}
{% block content %}
<script src="http://maps.googleapis.com/maps/api/js"></script>

<p>The homepage is actually showing up! Here's what to add later:</p>
<p>Relevant details</p>
<p>The main map, centered on SF or with the user's location</p>
<p>Details on what the site does and how to use it</p>
<p>Search</p>
<p>See a random truck <a href="/truck/323">here</a>.</p>
<div id="general-map"></div>


<script>
//note to self: Google Maps events for changing map boundaries are drag, bounds_changed, and center_changed. https://developers.google.com/maps/documentation/javascript/reference?hl=en

var today = new Date();
var weekday = new Array(7);
    weekday[0]=  "Sunday";
    weekday[1] = "Monday";
    weekday[2] = "Tuesday";
    weekday[3] = "Wednesday";
    weekday[4] = "Thursday";
    weekday[5] = "Friday";
    weekday[6] = "Saturday";


var todayString = weekday[today.getDay()];

function initMap() {

    var map;

    var mapOptions = {
        zoom: 12,
        center: new google.maps.LatLng(37.756366, -122.438632)
    };

    map = new google.maps.Map(
        document.getElementById("general-map"),
        mapOptions);

        // Retrieving the information with AJAX
    
    var infoWindow = new google.maps.InfoWindow({
        width: 100
    });
    // Keep this out of the loop so it only creates one info window at a time, otherwise, you'd get more and more each time you click a marker. No!

    $.get('/all_truck_info.json', function (truck_schedule_info) {
        // Attach markers to each truck location in returned JSON
        console.log(truck_schedule_info);
        var truck, marker, contentString;
                
        for (var key in truck_schedule_info) {
            
            truck = truck_schedule_info[key];

            // Define the marker
            marker = new google.maps.Marker({
                position: new google.maps.LatLng(truck.xCoordinate, truck.yCoordinate),
                map: map,
                title: 'Truck ID: ' + truck.truckName,
            });

            // Define the content of the infoWindow
            contentString = (
                '<div class="window-content">' +
                    '<p><b>Truck name: </b>' + truck.truckName + '</p><p><a href="/truck/' + truck.truckId + '">Learn more about this truck.</a></p><p><b>Day and times:</b> ' + truck.dayOfWeek + ', ' + truck.startTime + ' - ' + truck.endTime + '</p><p><b>Additional truck information: </b>' + truck.locationDescription + ". " + truck.extraText + '</p></div>');

            // Inside the loop we call bindInfoWindow passing it the marker,
            // map, infoWindow and contentString
            bindInfoWindow(marker, map, infoWindow, contentString);

        }

    });

    // Good place to put the loop that will append truck object information to the page itself.

    // This function is outside the for loop.
    // When a marker is clicked it closes any currently open infowindows
    // Sets the content for the new marker with the content passed through
    // then it open the infoWindow with the new content on the marker that's clicked
    function bindInfoWindow(marker, map, infoWindow, html) {
        google.maps.event.addListener(marker, 'click', function () {
            infoWindow.close();
            infoWindow.setContent(html);
            infoWindow.open(map, marker);
        });
    }
}

google.maps.event.addDomListener(window, 'load', initMap);



</script>
{% endblock %}